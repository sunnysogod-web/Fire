<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Fredoka:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; }
    body { font-family: 'Prompt', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .app-wrapper { height: 100%; width: 100%; overflow-y: auto; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    
    .fade-in { animation: fadeIn 0.6s ease-out; }
    .bounce-school { animation: bounce 2s ease infinite; }
    .loading-spin { animation: spin 1s linear infinite; }
    
    /* Modern Input Styling */
    .input-field {
      background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);
      border: 2px solid #e0e7ff;
      border-radius: 12px;
      padding: 0.95rem 1.1rem;
      font-family: 'Prompt', sans-serif;
      font-size: 15px;
      font-weight: 500;
      color: #1e293b;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      outline: none;
    }
    
    .input-field::placeholder {
      color: #a0aec0;
      font-weight: 500;
    }
    
    .input-field:focus {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-color: #667eea;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }
    
    .input-field:hover:not(:focus) {
      border-color: #cbd5e1;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    /* Form Group */
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      animation: fadeIn 0.6s ease-out backwards;
    }
    
    .form-label {
      font-size: 14px;
      font-weight: 600;
      color: #334155;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      opacity: 0.8;
    }
    
    .form-label-required::after {
      content: '*';
      color: #ef4444;
      margin-left: 4px;
    }
    
    /* Card Styling */
    .card {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    .card:hover {
      box-shadow: 0 30px 90px rgba(0, 0, 0, 0.12);
      transform: translateY(-4px);
    }
    
    /* Buttons */
    .btn-primary {
      padding: 1rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      border: none;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-family: 'Fredoka', sans-serif;
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    
    .btn-primary:active:not(:disabled) {
      transform: translateY(-1px);
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn-submit {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-approve {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }
    
    .btn-reject {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
    }
    
    /* Toast */
    .toast {
      padding: 1rem 1.5rem;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 0.875rem;
      animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.3px;
    }
    
    .toast-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }
    
    .toast-error {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }
    
    /* Header */
    .header-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.2);
    }
    
    /* Stats Card */
    .stat-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.5);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Request Card */
    .request-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 16px;
      padding: 1.5rem;
      border-left: 4px solid #667eea;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .request-card:hover {
      transform: translateX(4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    }
    
    .request-card.pending {
      border-left-color: #f59e0b;
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    }
    
    .request-card.approved {
      border-left-color: #10b981;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    }
    
    .request-card.rejected {
      border-left-color: #ef4444;
      background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    }
    
    /* Modal */
    .modal-overlay {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
    }
    
    .modal-content {
      animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Drop Zone */
    #drop-zone {
      background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);
      border: 2px dashed #cbd5e1;
    }

    #drop-zone.drag-over {
      border-color: #667eea !important;
      background: #f3f4ff !important;
      transform: scale(1.02);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-600 via-indigo-600 to-blue-600">
  <div class="app-wrapper">
    
    <div id="toast-container" class="fixed top-6 right-6 z-50 space-y-3 pointer-events-none"></div>

    <div id="loading-screen" class="fixed inset-0 bg-white/90 backdrop-filter backdrop-blur-md z-50 flex flex-col items-center justify-center gap-4">
      <div class="w-16 h-16 border-4 border-purple-200 border-t-purple-600 rounded-full loading-spin"></div>
      <p class="text-gray-700 font-semibold text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- LOGIN PAGE -->
    <div id="login-page" class="min-h-full flex items-center justify-center p-4 py-12">
      <div class="w-full max-w-md">
        <div class="text-center mb-12 fade-in">
          <div class="w-24 h-24 bg-white rounded-full mx-auto mb-6 flex items-center justify-center shadow-2xl">
            <span class="text-6xl bounce-school">üè´</span>
          </div>
          <h1 class="text-5xl font-bold text-white mb-2" style="font-family: 'Fredoka', sans-serif; letter-spacing: -1px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h1>
          <p class="text-purple-100 font-semibold text-lg">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏™‡∏á‡∏ó‡∏±‡∏ö‡∏ó‡∏¥‡∏°‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
        </div>

        <div class="card p-8">
          <div class="flex gap-0 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-t-lg mb-6 overflow-hidden">
            <button onclick="selectRole('student')" class="role-btn flex-1 py-4 font-bold text-center bg-white text-purple-600 shadow-md transition-all duration-300">üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            <button onclick="selectRole('staff')" class="role-btn flex-1 py-4 font-bold text-center text-gray-600 hover:text-gray-700 transition-all duration-300">üë®‚Äçüíº ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</button>
          </div>

          <form id="login-form" onsubmit="handleLogin(event)" class="space-y-5">
            <div class="form-group">
              <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
              <input type="text" id="login-id" required class="input-field w-full" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
            </div>

            <div class="form-group">
              <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input type="password" id="login-password" required class="input-field w-full" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>

            <button type="submit" class="btn-primary btn-submit w-full mt-8">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          </form>

          <div class="mt-6 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200">
            <p class="text-xs font-bold text-indigo-900 mb-2">üìã ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
            <p class="text-xs text-indigo-800 mb-1">üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ + <strong>1234</strong></p>
            <p class="text-xs text-indigo-800">üëî ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: <strong>admin</strong> | <strong>admin123</strong></p>
          </div>
        </div>
      </div>
    </div>

    <!-- STUDENT DASHBOARD -->
    <div id="student-dash" class="hidden">
      <div class="header-gradient text-white sticky top-0 z-20">
        <div class="max-w-6xl mx-auto px-4 py-6 flex justify-between items-center flex-wrap gap-4">
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-white/20 backdrop-blur rounded-full flex items-center justify-center">
              <span class="text-3xl">üè´</span>
            </div>
            <div>
              <h1 class="font-bold text-2xl" style="font-family: 'Fredoka', sans-serif;">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô</h1>
              <p id="student-name" class="text-purple-100 text-sm font-semibold">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            </div>
          </div>
          <button onclick="logout()" class="px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg font-semibold transition-all duration-300 backdrop-blur text-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </div>

      <div class="max-w-6xl mx-auto p-6 space-y-8 pb-12">
        <!-- Stats -->
        <div class="grid md:grid-cols-3 gap-5">
          <div class="stat-card fade-in" style="animation-delay: 0.1s;">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-sm font-bold text-gray-600 mb-2">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                <p class="stat-number" id="stat-pending-student">0</p>
              </div>
              <span class="text-4xl opacity-20">üìù</span>
            </div>
          </div>
          <div class="stat-card fade-in" style="animation-delay: 0.2s;">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-sm font-bold text-gray-600 mb-2">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                <p class="stat-number text-green-600" id="stat-approved-student">0</p>
              </div>
              <span class="text-4xl opacity-20">‚úÖ</span>
            </div>
          </div>
          <div class="stat-card fade-in" style="animation-delay: 0.3s;">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-sm font-bold text-gray-600 mb-2">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                <p class="stat-number text-red-600" id="stat-rejected-student">0</p>
              </div>
              <span class="text-4xl opacity-20">‚ùå</span>
            </div>
          </div>
        </div>

        <!-- Form -->
        <div class="card p-8 fade-in">
          <h2 class="text-2xl font-bold text-gray-800 mb-8 flex items-center gap-3" style="font-family: 'Fredoka', sans-serif;">
            <span class="text-3xl">üìã</span> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡∏≤
          </h2>

          <form id="student-form" onsubmit="submitRequest(event)" class="space-y-8">
            <!-- Row 1: ‡∏ä‡∏∑‡πà‡∏≠ ‡∏ä‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≠‡∏á -->
            <div class="grid md:grid-cols-3 gap-6">
              <div class="form-group" style="animation-delay: 0.1s;">
                <label class="form-label form-label-required">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                <input type="text" id="form-name" required class="input-field w-full" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
              </div>
              <div class="form-group" style="animation-delay: 0.2s;">
                <label class="form-label form-label-required">‡∏ä‡∏±‡πâ‡∏ô</label>
                <select id="form-level" required class="input-field w-full">
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô --</option>
                  <option value="‡∏°.1">‡∏°.1</option>
                  <option value="‡∏°.2">‡∏°.2</option>
                  <option value="‡∏°.3">‡∏°.3</option>
                  <option value="‡∏°.4">‡∏°.4</option>
                  <option value="‡∏°.5">‡∏°.5</option>
                  <option value="‡∏°.6">‡∏°.6</option>
                </select>
              </div>
              <div class="form-group" style="animation-delay: 0.3s;">
                <label class="form-label form-label-required">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <select id="form-room" required class="input-field w-full">
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
              </div>
            </div>

            <!-- Row 2: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏ß‡∏•‡∏≤ -->
            <div class="grid md:grid-cols-3 gap-6">
              <div class="form-group md:col-span-1" style="animation-delay: 0.4s;">
                <label class="form-label form-label-required">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</label>
                <input type="date" id="form-date" required class="input-field w-full">
              </div>
              <div class="form-group md:col-span-1" style="animation-delay: 0.5s;">
                <label class="form-label form-label-required">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
                <input type="time" id="form-leave-time" required class="input-field w-full">
              </div>
              <div class="form-group md:col-span-1" style="animation-delay: 0.6s;">
                <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö</label>
                <input type="time" id="form-return-time" class="input-field w-full">
              </div>
            </div>

            <!-- Row 3: ‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á ‡πÄ‡∏ö‡∏≠‡∏£‡πå -->
            <div class="grid md:grid-cols-2 gap-6">
              <div class="form-group" style="animation-delay: 0.7s;">
                <label class="form-label form-label-required">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</label>
                <input type="text" id="form-parent-name" required class="input-field w-full" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á">
              </div>
              <div class="form-group" style="animation-delay: 0.8s;">
                <label class="form-label form-label-required">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                <input type="tel" id="form-parent-phone" required class="input-field w-full" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
              </div>
            </div>

            <!-- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• -->
            <div class="form-group" style="animation-delay: 0.9s;">
              <label class="form-label form-label-required">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
              <textarea id="form-reason" required class="input-field w-full h-24 resize-none" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡πà‡∏ß‡∏¢ ‡∏ò‡∏∏‡∏£‡∏∞‡∏î‡πà‡∏ß‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô..."></textarea>
            </div>

            <!-- Photo Section -->
            <div class="form-group" style="animation-delay: 1.0s;">
              <label class="form-label">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢</label>
              <div id="drop-zone" class="border-2 border-dashed border-purple-300 rounded-xl p-8 text-center cursor-pointer transition-all duration-300 hover:border-purple-500 hover:bg-purple-50" onclick="document.getElementById('photo-upload').click()">
                <div class="text-5xl mb-3">üì∏</div>
                <p class="text-gray-700 font-semibold mb-1">‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                <p class="text-sm text-gray-500">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</p>
              </div>
              <input type="file" id="photo-upload" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
              
              <div class="mt-4">
                <button type="button" onclick="openCamera()" class="w-full btn-primary bg-gradient-to-r from-blue-500 to-cyan-500 text-white flex items-center justify-center gap-2">
                  üì∑ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ
                </button>
              </div>

              <div id="photo-preview" class="mt-4 rounded-lg overflow-hidden shadow-md" style="display: none;">
                <img id="preview-img" src="" alt="Preview" style="width: 100%; height: auto; max-height: 300px; object-fit: cover;">
                <button type="button" onclick="removePhoto()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 transition-all duration-300">‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
              </div>
            </div>

            <button type="submit" id="submit-btn" class="btn-primary btn-submit w-full mt-10">üöÄ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
          </form>
        </div>

        <!-- History -->
        <div class="card p-8 fade-in">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3" style="font-family: 'Fredoka', sans-serif;">
            <span class="text-3xl">üìú</span> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
          </h2>
          <div id="student-history" class="space-y-4">
            <p class="text-center text-gray-400 py-8 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
          </div>
        </div>
      </div>
    </div>

    <!-- STAFF DASHBOARD -->
    <div id="staff-dash" class="hidden">
      <div class="header-gradient text-white sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 py-6 flex justify-between items-center flex-wrap gap-4">
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-white/20 backdrop-blur rounded-full flex items-center justify-center">
              <span class="text-3xl">üè´</span>
            </div>
            <div>
              <h1 class="font-bold text-2xl" style="font-family: 'Fredoka', sans-serif;">‡πÅ‡∏ú‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h1>
              <p id="staff-name" class="text-purple-100 text-sm font-semibold">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
            </div>
          </div>
          <button onclick="logout()" class="px-6 py-2 bg-white/20 hover:bg-white/30 rounded-lg font-semibold transition-all duration-300 backdrop-blur text-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </div>

      <div class="max-w-7xl mx-auto p-6 space-y-8 pb-12">
        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-5">
          <div class="stat-card fade-in" style="animation-delay: 0.1s;">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-xs font-bold text-gray-600 mb-2">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <p class="stat-number" id="stat-total">0</p>
              </div>
              <span class="text-3xl opacity-20">üìä</span>
            </div>
          </div>
          <div class="stat-card fade-in" style="animation-delay: 0.2s;">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-xs font-bold text-gray-600 mb-2">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                <p class="stat-number text-amber-600" id="stat-pending">0</p>
              </div>
              <span class="text-3xl opacity-20">‚è≥</span>
            </div>
          </div>
          <div class="stat-card fade-in" style="animation-delay: 0.3s;">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-xs font-bold text-gray-600 mb-2">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                <p class="stat-number text-green-600" id="stat-approved">0</p>
              </div>
              <span class="text-3xl opacity-20">‚úÖ</span>
            </div>
          </div>
          <div class="stat-card fade-in" style="animation-delay: 0.4s;">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-xs font-bold text-gray-600 mb-2">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                <p class="stat-number text-red-600" id="stat-rejected">0</p>
              </div>
              <span class="text-3xl opacity-20">‚ùå</span>
            </div>
          </div>
        </div>

        <!-- Filter -->
        <div class="card p-3 sticky top-28 z-10 flex gap-2 overflow-x-auto shadow-lg">
          <button onclick="filterRequests('all')" class="filter-btn flex-1 py-3 px-4 rounded-lg bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold whitespace-nowrap text-sm transition-all duration-300" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button onclick="filterRequests('pending')" class="filter-btn flex-1 py-3 px-4 rounded-lg text-gray-700 hover:bg-gray-100 whitespace-nowrap text-sm font-semibold transition-all duration-300" data-filter="pending">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
          <button onclick="filterRequests('approved')" class="filter-btn flex-1 py-3 px-4 rounded-lg text-gray-700 hover:bg-gray-100 whitespace-nowrap text-sm font-semibold transition-all duration-300" data-filter="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</button>
          <button onclick="filterRequests('rejected')" class="filter-btn flex-1 py-3 px-4 rounded-lg text-gray-700 hover:bg-gray-100 whitespace-nowrap text-sm font-semibold transition-all duration-300" data-filter="rejected">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
        </div>

        <!-- Requests -->
        <div id="staff-requests" class="space-y-5">
          <p class="text-center text-gray-400 py-12 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>
      </div>
    </div>

    <!-- Camera Modal -->
    <div id="camera-modal" class="hidden fixed inset-0 modal-overlay z-40 flex items-center justify-center p-4">
      <div class="card p-6 max-w-md w-full modal-content">
        <h3 class="text-xl font-bold text-gray-800 mb-4">üì∑ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</h3>
        <video id="camera-video" style="width: 100%; border-radius: 12px; background: #000; margin-bottom: 1rem; display: none;"></video>
        <canvas id="camera-canvas" style="width: 100%; border-radius: 12px; margin-bottom: 1rem; display: none;"></canvas>
        <div id="camera-buttons" class="flex gap-3">
          <button type="button" onclick="startCamera()" class="flex-1 btn-primary bg-blue-500 hover:bg-blue-600 text-white">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
          <button type="button" onclick="capturePhoto()" id="capture-btn" class="flex-1 btn-primary bg-green-500 hover:bg-green-600 text-white" style="display: none;">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>
          <button type="button" onclick="closeCamera()" class="flex-1 btn-primary bg-gray-300 hover:bg-gray-400 text-gray-800">‡∏õ‡∏¥‡∏î</button>
        </div>
        <div id="camera-confirm" style="display: none; gap: 0.75rem;" class="flex mt-4">
          <button type="button" onclick="confirmCapture()" class="flex-1 btn-primary btn-approve">‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
          <button type="button" onclick="startCamera()" class="flex-1 btn-primary bg-gray-300 hover:bg-gray-400 text-gray-800">‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</button>
        </div>
      </div>
    </div>

    <!-- Rejection Modal -->
    <div id="rejection-modal" class="hidden fixed inset-0 modal-overlay z-40 flex items-center justify-center p-4">
      <div class="card p-6 max-w-md w-full modal-content">
        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center gap-2">
          <span>‚ö†Ô∏è</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
        </h3>
        <textarea id="rejection-text" class="input-field w-full h-24 resize-none mb-6" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥..."></textarea>
        <div class="flex gap-3">
          <button onclick="closeRejectionModal()" class="flex-1 btn-primary bg-gray-200 hover:bg-gray-300 text-gray-800">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button onclick="submitRejection()" class="flex-1 btn-primary btn-reject">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCm9QsD6NwRF0zusMzgESEyA43hjEyHRhw",
      authDomain: "sw-website-68.firebaseapp.com",
      databaseURL: "https://sw-website-68-default-rtdb.firebaseio.com",
      projectId: "sw-website-68",
      storageBucket: "sw-website-68.firebasestorage.app",
      messagingSenderId: "728405606506",
      appId: "1:728405606506:web:28d2f983c552a118e9397c",
      measurementId: "G-ESPPG76N3H"
    };

    let db = null;
    let realtimeUnsubscribe = null;

    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
    } catch (error) {
      console.error('Firebase error:', error);
    }

    let allRequests = [];
    let currentUser = null;
    let currentRole = null;
    let currentFilter = 'all';
    let rejectionId = null;
    let photoData = null;
    let cameraStream = null;

    const demoStaff = { 'admin': { pass: 'admin123', name: '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏°‡∏µ‡πÄ‡∏°‡∏ï‡∏ï‡∏≤' } };

    async function loadData() {
      if (!db) {
        const data = localStorage.getItem('leaveRequests');
        allRequests = data ? JSON.parse(data) : [];
        return;
      }
      try {
        const snapshot = await db.collection('leaveRequests').orderBy('createdAt', 'desc').get();
        allRequests = [];
        snapshot.forEach(doc => allRequests.push({ id: doc.id, ...doc.data() }));
      } catch (error) {
        const data = localStorage.getItem('leaveRequests');
        allRequests = data ? JSON.parse(data) : [];
      }
    }

    function showToast(msg, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `<span class="text-xl">‚ú®</span><span>${msg}</span>`;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function selectRole(role) {
      currentRole = role;
      document.querySelectorAll('.role-btn').forEach((btn, i) => {
        btn.style.background = ((role === 'student' && i === 0) || (role === 'staff' && i === 1)) ? '#ffffff' : 'transparent';
        btn.style.color = ((role === 'student' && i === 0) || (role === 'staff' && i === 1)) ? '#667eea' : '#666';
        btn.style.boxShadow = ((role === 'student' && i === 0) || (role === 'staff' && i === 1)) ? '0 4px 12px rgba(0,0,0,0.1)' : 'none';
      });
    }

    function handleLogin(e) {
      e.preventDefault();
      const id = document.getElementById('login-id').value.trim();
      const pass = document.getElementById('login-password').value;

      if (currentRole === 'student') {
        if (pass === '1234') {
          currentUser = { userId: id, role: 'student' };
          loadData().then(() => {
            showStudentDash();
            showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô!`);
          });
        } else {
          showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        }
      } else {
        const staff = demoStaff[id];
        if (staff && staff.pass === pass) {
          currentUser = { ...staff, userId: id, role: 'staff' };
          loadData().then(() => {
            showStaffDash();
            showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${staff.name}!`);
          });
        } else {
          showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        }
      }
    }

    function logout() {
      if (realtimeUnsubscribe) realtimeUnsubscribe();
      if (cameraStream) cameraStream.getTracks().forEach(track => track.stop());
      currentUser = null;
      currentRole = null;
      photoData = null;
      cameraStream = null;
      document.getElementById('login-page').classList.remove('hidden');
      document.getElementById('student-dash').classList.add('hidden');
      document.getElementById('staff-dash').classList.add('hidden');
      document.getElementById('login-form').reset();
      selectRole('student');
    }

    function showStudentDash() {
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('student-dash').classList.remove('hidden');
      document.getElementById('staff-dash').classList.add('hidden');
      document.getElementById('student-name').textContent = '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
      document.getElementById('loading-screen').classList.add('hidden');
      setupDragAndDrop();
      loadStudentHistory();
    }

    function showStaffDash() {
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('student-dash').classList.add('hidden');
      document.getElementById('staff-dash').classList.remove('hidden');
      document.getElementById('staff-name').textContent = currentUser.name;
      document.getElementById('loading-screen').classList.add('hidden');
      setupRealtimeListener();
    }

    function setupDragAndDrop() {
      const dropZone = document.getElementById('drop-zone');
      
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
      });

      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('drag-over');
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handlePhotoFile(files[0]);
        }
      });
    }

    function handlePhotoFile(file) {
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          photoData = e.target.result;
          displayPhoto();
        };
        reader.readAsDataURL(file);
      } else {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
      }
    }

    function openCamera() {
      document.getElementById('camera-modal').classList.remove('hidden');
    }

    function closeCamera() {
      if (cameraStream) cameraStream.getTracks().forEach(track => track.stop());
      cameraStream = null;
      document.getElementById('camera-modal').classList.add('hidden');
      document.getElementById('camera-video').style.display = 'none';
      document.getElementById('camera-canvas').style.display = 'none';
      document.getElementById('camera-buttons').style.display = 'flex';
      document.getElementById('camera-confirm').style.display = 'none';
    }

    async function startCamera() {
      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
        const video = document.getElementById('camera-video');
        video.srcObject = cameraStream;
        video.style.display = 'block';
        document.getElementById('capture-btn').style.display = 'block';
      } catch (error) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ', 'error');
      }
    }

    function capturePhoto() {
      const video = document.getElementById('camera-video');
      const canvas = document.getElementById('camera-canvas');
      const ctx = canvas.getContext('2d');
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      
      photoData = canvas.toDataURL('image/jpeg');
      
      video.style.display = 'none';
      canvas.style.display = 'block';
      canvas.src = photoData;
      
      if (cameraStream) cameraStream.getTracks().forEach(track => track.stop());
      cameraStream = null;
      
      document.getElementById('camera-buttons').style.display = 'none';
      document.getElementById('camera-confirm').style.display = 'flex';
    }

    function confirmCapture() {
      displayPhoto();
      closeCamera();
    }

    function displayPhoto() {
      document.getElementById('preview-img').src = photoData;
      document.getElementById('photo-preview').style.display = 'block';
    }

    function handlePhotoUpload(event) {
      const file = event.target.files[0];
      if (file) {
        handlePhotoFile(file);
      }
    }

    function removePhoto() {
      photoData = null;
      document.getElementById('photo-preview').style.display = 'none';
      document.getElementById('photo-upload').value = '';
    }

    async function submitRequest(e) {
      e.preventDefault();
      const request = {
        id: String(Date.now()),
        studentId: currentUser.userId,
        studentName: document.getElementById('form-name').value,
        studentLevel: document.getElementById('form-level').value,
        studentRoom: `${document.getElementById('form-level').value}/${document.getElementById('form-room').value}`,
        parentName: document.getElementById('form-parent-name').value,
        parentPhone: document.getElementById('form-parent-phone').value,
        reason: document.getElementById('form-reason').value,
        leaveDate: document.getElementById('form-date').value,
        leaveTime: document.getElementById('form-leave-time').value,
        returnTime: document.getElementById('form-return-time').value || '-',
        photo: photoData || null,
        status: 'pending',
        createdAt: new Date().toLocaleString('th-TH'),
        rejectionNote: ''
      };

      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading-spin w-4 h-4 border-2 border-white/30 border-t-white rounded-full inline-block"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

      try {
        if (db) {
          await db.collection('leaveRequests').doc(request.id).set({
            ...request,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
        allRequests.unshift(request);
        showToast('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
        document.getElementById('student-form').reset();
        removePhoto();
        loadStudentHistory();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'üöÄ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠';
      }
    }

    function loadStudentHistory() {
      const myRequests = allRequests.filter(r => r.studentId === currentUser.userId);
      const container = document.getElementById('student-history');
      document.getElementById('stat-pending-student').textContent = myRequests.filter(r => r.status === 'pending').length;
      document.getElementById('stat-approved-student').textContent = myRequests.filter(r => r.status === 'approved').length;
      document.getElementById('stat-rejected-student').textContent = myRequests.filter(r => r.status === 'rejected').length;

      if (myRequests.length === 0) {
        container.innerHTML = '<p class="text-center text-gray-400 py-8 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>';
        return;
      }

      const statusLabels = { pending: '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö', approved: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', rejected: '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' };
      const statusEmoji = { pending: '‚è≥', approved: '‚úÖ', rejected: '‚ùå' };
      
      container.innerHTML = myRequests.map(req => {
        const statusClass = req.status === 'pending' ? 'pending' : req.status === 'approved' ? 'approved' : 'rejected';
        retu
